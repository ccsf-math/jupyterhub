#!/usr/bin/env bash
set -euo pipefail

: "${CONDA_DIR:?CONDA_DIR not set}"

# Ensure Playwright installs browsers into Conda path
export PLAYWRIGHT_BROWSERS_PATH=${CONDA_DIR}

# Install browsers (Chromium needed for nbconvert webpdf)
python -m playwright install --with-deps chromium firefox webkit

# Enable nbgitpuller
jupyter server extension enable --sys-prefix nbgitpuller

# Copy configuration files
mkdir -p /srv/conda/envs/notebook/share/jupyter/lab/settings
cp -u overrides.json /srv/conda/envs/notebook/share/jupyter/lab/settings

mkdir -p /srv/conda/envs/notebook/etc/jupyter
cp -u jupyter_lab_config.py /srv/conda/envs/notebook/etc/jupyter
