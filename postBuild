#!/usr/bin/env bash
# Derived from https://github.com/cal-icor/base-user-image/blob/main/postBuild

set -euo pipefail

# Install Playwright browsers
python -m playwright install --with-deps chromium firefox webkit

# installing chromium browser to enable webpdf conversion using nbconvert
export PLAYWRIGHT_BROWSERS_PATH=${CONDA_DIR}
playwright install chromium

# Enable nbgitpuller
jupyter server extension enable --sys-prefix nbgitpuller

# Copy configuration files
mkdir -p /srv/conda/envs/notebook/share/jupyter/lab/settings
cp -u overrides.json /srv/conda/envs/notebook/share/jupyter/lab/settings

mkdir -p /srv/conda/envs/notebook/etc/jupyter
cp -u jupyter_lab_config.py /srv/conda/envs/notebook/etc/jupyter
